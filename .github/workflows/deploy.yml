name: 🚀 New Deploy Script
on:
  pull_request:
    paths:
      - 'site/images/**'


      
jobs:
  compress:
    name: 🗜️ Compress Images
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          ref: ${{ github.head_ref }}
      - uses: namoscato/action-tinify@v1
        with:
          api_key: ${{ secrets.TINIFY_API_KEY }}

  web-deploy:
    name: 🎉 Deploy
    needs: compress
    runs-on: ubuntu-latest
    steps:
    - name: 🚚 Get latest code
      uses: actions/checkout@v3
    
    - name: 📂 Sync files
      uses: SamKirkland/FTP-Deploy-Action@v4.3.4
      with:
        server: ftp.bgsandbox.com
        username: developer@bgsandbox.com
        password: ${{ secrets.ftp_password }}
        port: 21
        local-dir: ./site/
        server-dir: /public_html/tinypng-test/
        exclude: |
          **/.DS_Store
          **/.git*
          **/.git*/**
          **/node_modules/**
          **/assets/sass/**
          **/uswds/img/material-icons-deprecated/**
          **/uswds/img/material-icons/*         

